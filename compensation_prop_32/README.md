# @Compound-Community/merkle-distributor (forked from @dharma-eng/merkle-distributor)

These contracts have been modified to include a mechanism for "funding" the distributor from a specific funder and with a specific amount of the target token, designated at the time of deployment. The funder must first approve the distributor to transfer the tokens to be funded on its behalf.

# Usage for generating Compound COMP distribution merkle tree for 11/26/20 event
### Dependancies
- node version 10 or higher
- yarn
- run `yarn` in the terminal while located at the project root to install the remaining dependancies

### Generation
- Delete the `generateAddressBalances/addressBalances.json` and `generateAddressBalances/addressBalancesDecimal.json` files--you will be generating these locally.
- Delete the `merkle-root/compCompensationMerkleTree.json` file--you will be generating this locally.

#### Affected Address List
- Create the list of affected addresses and COMP to distribute to them by running `node generateAddressBalances/generateAddressBalances.js`. This file is written to `generateAddressBalances/addressBalances.json`. The numbers in this file are stored in hexadecimal value: if you want the decimal numbers, run `node generateAddressBalances/generateAddressBalancesDecimal.js`. 
- These scripts fetch the liquidation transactions which repaid Dai within the given block bounds (11332733 to 11335286). The repaid Dai is multiplied by 0.08 to attain the liquidation fee incured by the affected address. This fee is then converted to COMP using the rate of $123.39/COMP.

#### Merkle Tree
- Once the address balances are attained, the merkle tree can be generated by running `npx ts-node scripts/generate-merkle-root.ts --input generateAddressBalances/addressBalances.json`. The merkle tree is written to `merkle-root/compCompensationMerkleTree.json`. 
- This script uses the tried and proven code written by Uniswap for their UNI distribution. The list of addresses and amounts is inputted to it, and it generates a merkle tree. This tree allows for the smart contract to store a very small amount of data which represents all the data stored in the address-balance list.


# Local Development

The following assumes the use of `node@>=10`.

## Install Dependencies

`yarn`

## Compile Contracts

`yarn compile`

## Run Tests

`yarn test`
